<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>L3tvia - Kernel Exploit</title>
    <subtitle>Linux kenel exploitation tutorial by rona</subtitle>
    <link rel="self" type="application/atom+xml" href="https://l3tvia.rqda.wtf/tags/kernel-exploit/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://l3tvia.rqda.wtf"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2024-10-18T05:00:00+00:00</updated>
    <id>https://l3tvia.rqda.wtf/tags/kernel-exploit/atom.xml</id>
    <entry xml:lang="en">
        <title>WORD56号</title>
        <published>2024-10-18T05:00:00+00:00</published>
        <updated>2024-10-18T05:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://l3tvia.rqda.wtf/book56/"/>
        <id>https://l3tvia.rqda.wtf/book56/</id>
        
        <content type="html" xml:base="https://l3tvia.rqda.wtf/book56/">&lt;h1 id=&quot;kontentuyi-lan&quot;&gt;コンテンツ一覧&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;drive.proton.me&#x2F;urls&#x2F;524KN0JS58#Dr212Euef2nX&quot;&gt;book56.tar.gz&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;paste.c-net.org&#x2F;HeineVirginia&quot;&gt;コマンドコピペ用URL&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;jie-shuo&quot;&gt;解説&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;mod-probeshu-kihuan-e&quot;&gt;mod_probe書き換え&lt;&#x2F;h2&gt;
&lt;p&gt;To be added...&lt;&#x2F;p&gt;
&lt;h2 id=&quot;task-structshu-kihuan-e&quot;&gt;task_struct書き換え&lt;&#x2F;h2&gt;
&lt;p&gt;To be added...&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Kernel Exploit環境構築</title>
        <published>2024-10-17T15:00:00+00:00</published>
        <updated>2024-10-17T15:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://l3tvia.rqda.wtf/build/"/>
        <id>https://l3tvia.rqda.wtf/build/</id>
        
        <content type="html" xml:base="https://l3tvia.rqda.wtf/build/">&lt;h2 id=&quot;xiang-ding-huan-jing&quot;&gt;想定環境&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;OS: Ubuntu 22.04&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;kanerunobirudotososukodorideingunohuan-jing-zheng-bei&quot;&gt;カーネルのビルドとソースコードリーディングの環境整備&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;gccwozui-xin-nisuru&quot;&gt;GCCを最新にする&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; add-apt-repository ppa:ubuntu-toolchain-r&#x2F;test
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; apt-get update
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; apt-get install gcc-13 g++-13
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; update-alternatives&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; --install&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;usr&#x2F;bin&#x2F;gcc gcc &#x2F;usr&#x2F;bin&#x2F;gcc-13 100&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; --slave&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;usr&#x2F;bin&#x2F;g++ g++ &#x2F;usr&#x2F;bin&#x2F;g++-13
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;ti-gong-huairunobaziyonque-ren&quot;&gt;提供ファイルのバージョン確認&lt;&#x2F;h3&gt;
&lt;p&gt;以下を実行しカーネルのバージョンを特定する&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#8be9fd;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;ctf
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;strings&lt;&#x2F;span&gt;&lt;span&gt; bzImage &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;grep&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -E &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;&amp;#39;[0-9]+\.[0-9]+\.[0-9]+&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;linuxsosunoclone&quot;&gt;Linuxソースのclone&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; clone https:&#x2F;&#x2F;github.com&#x2F;gregkh&#x2F;linux.git&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -b&lt;&#x2F;span&gt;&lt;span&gt; linux-6.6.y
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8be9fd;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; linux
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; fetch&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; --tags&lt;&#x2F;span&gt;&lt;span&gt; origin linux-6.6.y:linux-6.6.y
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; checkout v6.6.77
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;debatugusinboruwotuketebirudo&quot;&gt;デバッグシンボルをつけてビルド&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#6272a4;&quot;&gt;# 依存パッケージのインストール
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; apt install libncurses-dev gawk flex bison openssl libssl-dev dkms libelf-dev libudev-dev libpci-dev libiberty-dev autoconf llvm bear dwarves cpio bc
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;dehuorutodebirudosuruchang-he&quot;&gt;- デフォルトでビルドする場合&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;make&lt;&#x2F;span&gt;&lt;span&gt; alldefconfig &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;&amp;amp;&amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;make&lt;&#x2F;span&gt;&lt;span&gt; menuconfig
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;confighuairugati-gong-sareteiruchang-he&quot;&gt;- configファイルが提供されている場合&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;cp&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;ctf&#x2F;config .config
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;make&lt;&#x2F;span&gt;&lt;span&gt; olddefconfig &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;&amp;amp;&amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;make&lt;&#x2F;span&gt;&lt;span&gt; menuconfig
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;以下のコンフィグをオンにする&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CONFIG_8250&lt;&#x2F;code&gt;,&lt;code&gt;CONFIG_8250_CONSOLE&lt;&#x2F;code&gt;: ログを出力させるために必要&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_BLK_DEV_INITRD&lt;&#x2F;code&gt;: rootfs(initramfs)のマウントに必要&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_DEVTMPFS&lt;&#x2F;code&gt;,&lt;code&gt;CONFIG_DEVTMPFS_MOUNT&lt;&#x2F;code&gt;: &#x2F;devの自動マウント&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT&lt;&#x2F;code&gt;: シンボル付きvmlinuxを吐く&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_BINFMT_SCRIPT&lt;&#x2F;code&gt;,&lt;code&gt;CONFIG_BINFMT_MISC&lt;&#x2F;code&gt;: エクスプロイトでよく使うmodprobeを有効化&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;ビルド(5分くらいかかる)&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;bear&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt; --&lt;&#x2F;span&gt;&lt;span&gt; make -j$(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;nproc&lt;&#x2F;span&gt;&lt;span&gt;) bzImage vmlinux
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;&#x2F;vmlinux&lt;&#x2F;code&gt;がデバッグシンボル付きのカーネルイメージで&lt;code&gt;&#x2F;arch&#x2F;x86&#x2F;boot&#x2F;bzImage&lt;&#x2F;code&gt;がカーネルなのでこれを問題ファイルにコピー&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;mv&lt;&#x2F;span&gt;&lt;span&gt; vmlinux &#x2F;path&#x2F;to&#x2F;ctf&#x2F;vmlinux.own
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;mv&lt;&#x2F;span&gt;&lt;span&gt; bzImage &#x2F;path&#x2F;to&#x2F;ctf&#x2F;bzImage.own
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;sosukodorideingu&quot;&gt;ソースコードリーディング&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;clionnochang-he&quot;&gt;- CLionの場合&lt;&#x2F;h4&gt;
&lt;ol&gt;
&lt;li&gt;初期画面からopenを選択&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;&#x2F;compile_commands.json&lt;&#x2F;code&gt;を選択&lt;&#x2F;li&gt;
&lt;li&gt;Open as Projectを選択&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h4 id=&quot;vscodenochang-he&quot;&gt;- VSCodeの場合&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;p3land.smallkirby.com&#x2F;kernel&#x2F;prepare&quot;&gt;https:&#x2F;&#x2F;p3land.smallkirby.com&#x2F;kernel&#x2F;prepare&lt;&#x2F;a&gt; を読むといいらしい(VSCodeを使ってないので詳しくはわからない)&lt;&#x2F;p&gt;
&lt;h2 id=&quot;turulei-noinsutoru&quot;&gt;ツール類のインストール&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;lysithea&quot;&gt;lysithea&lt;&#x2F;h3&gt;
&lt;p&gt;お好きな場所で&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; clone git@github.com:smallkirby&#x2F;lysithea.git
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;vermagic&quot;&gt;vermagic&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;git@github.com:yaxinsn&#x2F;vermagic.git
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#8be9fd;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; vermagic
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;make&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -j$(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;nproc&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;gef&quot;&gt;gef&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;wget&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -q&lt;&#x2F;span&gt;&lt;span&gt; https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;bata24&#x2F;gef&#x2F;dev&#x2F;install.sh&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -O- &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;qemu&quot;&gt;QEMU&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; apt install qemu-system qemu-system-common qemu-utils
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;pasuhenozhui-jia&quot;&gt;パスへの追加&lt;&#x2F;h3&gt;
&lt;p&gt;bashrcに以下を追加&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffffff;&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffffff;&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;:&#x2F;path&#x2F;to&#x2F;lysithea&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffffff;&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffffff;&quot;&gt;PATH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;:&#x2F;path&#x2F;to&#x2F;vermagic&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;wen-ti-wojie-ku&quot;&gt;問題を解く&lt;&#x2F;h2&gt;
&lt;p&gt;一般に以下のファイルが提供される&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bzImage&lt;&#x2F;code&gt;: カーネル&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;rootfs.cpio&lt;&#x2F;code&gt; or &lt;code&gt;initramfs.cpio&lt;&#x2F;code&gt;: rootファイルシステム&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;[name].ko&lt;&#x2F;code&gt;: カーネルオブジェクト&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;run.sh&lt;&#x2F;code&gt;: 実行するためのシェルスクリプト&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;追加でこれらのファイルが提供されていると嬉しい&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.config&lt;&#x2F;code&gt;: ビルドコンフィグ&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;[name].c&lt;&#x2F;code&gt;: カーネルオブジェクトのソースコード&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;deirekutorinochu-qi-hua&quot;&gt;ディレクトリの初期化&lt;&#x2F;h3&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#8be9fd;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;path&#x2F;to&#x2F;ctf
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;lysithea&lt;&#x2F;span&gt;&lt;span&gt; init
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;lysithea&lt;&#x2F;span&gt;&lt;span&gt; extract
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;extract&lt;&#x2F;code&gt;ディレクトリにrootfsの内容が展開される。まずはデバッグようにルートでシェルを得られるようにする&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;grep&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -r &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;&amp;#39;setsid cttyhack setuidgid &amp;#39;&lt;&#x2F;span&gt;&lt;span&gt; extracted
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;を実行し出てきたファイルがCTF用の初期化ファイルである。そのファイルの中身を以下のように書き換える&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;diff&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-diff &quot;&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;- setsid cttyhack setuidgid 9999 sh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ setsid cttyhack setuidgid 0 sh
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;- echo 2 &amp;gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;kptr_restrict
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ echo 0 &amp;gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;kptr_restrict
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;- echo 1 &amp;gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;dmesg_restrict
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ echo 0 &amp;gt;&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;dmesg_restrict
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;kaslrnowu-xiao-hua&quot;&gt;KASLRの無効化&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;code&gt;run.sh.dev&lt;&#x2F;code&gt;を以下のように変更&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;diff&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-diff &quot;&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;- -kernel .&#x2F;bzImage
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ -kernel .&#x2F;bzImage.own
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;- -append &amp;quot;console=ttyS0 kaslr quiet
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ -append &amp;quot;console=ttyS0 nokaslr verbose
&lt;&#x2F;span&gt;&lt;span&gt;...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;+ -s
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;shi-xing&quot;&gt;実行&lt;&#x2F;h3&gt;
&lt;p&gt;以下のコマンドが&lt;code&gt;exploit&lt;&#x2F;code&gt;のコンパイルと便利ファイルの追加をした上で、&lt;code&gt;extracted&lt;&#x2F;code&gt;の圧縮を行い、&lt;code&gt;run.sh.dev&lt;&#x2F;code&gt;を実行してくれる&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;lysithea&lt;&#x2F;span&gt;&lt;span&gt; local
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;ここで、別タブでgdbを起動してアタッチするとカーネルの動きが追える&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; gdb vmlinux.own
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;gef&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; target remote:1234
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;gef&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt; directory &#x2F;path&#x2F;to&#x2F;linux &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6272a4;&quot;&gt;# ソースコードの表示
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;image&#x2F;build_result.png&quot; alt=&quot;image&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;toraburusiyuteingu&quot;&gt;トラブルシューティング&lt;&#x2F;h2&gt;
&lt;h3 id=&quot;invalid-module-formattoiueragachu-tachang-he&quot;&gt;&lt;code&gt;Invalid module format&lt;&#x2F;code&gt;というエラーが出た場合&lt;&#x2F;h3&gt;
&lt;p&gt;&lt;code&gt;linux&#x2F;include&#x2F;linux&#x2F;vermagic.h&lt;&#x2F;code&gt;を確認して必要なビルドオプションをつけて再度ビルドする&lt;&#x2F;p&gt;
&lt;h4 id=&quot;li&quot;&gt;例:&lt;&#x2F;h4&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#282a36;color:#f8f8f2;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;strings &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span&gt;chal&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;]&lt;&#x2F;span&gt;&lt;span&gt;.ko &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff79c6;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#50fa7b;&quot;&gt;grep&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffb86c;&quot;&gt; -E &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f1fa8c;&quot;&gt;&amp;#39;[0-9]+\.[0-9]+\.[0-9]+&amp;#39;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;を実行して、&lt;code&gt;6.6.58 SMP preempt mod_unload&lt;&#x2F;code&gt;が出てきたとする&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CONFIG_SMP=y&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_PREEMPT_BUILD=y&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_MODULE_UNLOAD=y&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;CONFIG_MODVERSIONS=n&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;RANDSTRUCT_NONE=y&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;上記のコンフィグを設定してカーネルを再度ビルド&lt;&#x2F;p&gt;
&lt;h2 id=&quot;can-kao-wen-xian&quot;&gt;参考文献&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;p3land.smallkirby.com&#x2F;kernel&#x2F;&quot;&gt;p3land (セクキャンの講義資料)&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;hackmd.io&#x2F;@bata24&#x2F;ryWzOHEMw&quot;&gt;qemu 各種アーキ環境構築&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a rel=&quot;noopener&quot; target=&quot;_blank&quot; href=&quot;https:&#x2F;&#x2F;hackmd.io&#x2F;@t3mp&#x2F;H1jTrjTp2&quot;&gt;Linux Kernel Debug Enviroment with buildroot&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
</feed>
